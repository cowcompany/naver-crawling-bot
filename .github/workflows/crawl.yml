name: ìë™ í¬ë¡¤ë§ ì‹¤í–‰

on:
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ ìì • (UTC) ì‹¤í–‰ (í•œêµ­ ì‹œê°„ ì˜¤ì „ 9ì‹œ)
  workflow_dispatch:  # í•„ìš”í•  ë•Œ ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

permissions:
  contents: write  # âœ… GitHub Actionsê°€ push í•  ìˆ˜ ìˆë„ë¡ ê¶Œí•œ ì¶”ê°€

jobs:
  run-script:
    runs-on: ubuntu-latest

    steps:
      - name: ì €ì¥ì†Œ ì½”ë“œ ë¶ˆëŸ¬ì˜¤ê¸°
        uses: actions/checkout@v3

      - name: Python ì„¤ì¹˜
        uses: actions/setup-python@v3
        with:
          python-version: '3.9'

      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: |
          pip install requests

      - name: í¬ë¡¤ë§ ì½”ë“œ ì‹¤í–‰
        run: python crawling_script.py

        

      - name: ê²°ê³¼ë¥¼ GitHub ì €ì¥ì†Œì— ì €ì¥
        run: |
          git config --global user.name "cowcompany"
          git config --global user.email "cowcompany1@gmail.com"
          git init  # âœ… ì €ì¥ì†Œ ì´ˆê¸°í™” (í•„ìˆ˜)
          git add data/*.csv
          git commit -m "ìë™ í¬ë¡¤ë§ ë°ì´í„° ì €ì¥: $(date)"
          git branch -M main  # âœ… ë¸Œëœì¹˜ê°€ ì—†ì„ ê²½ìš° mainìœ¼ë¡œ ë³€ê²½
          git push -u origin main

      - name: Git ì„¤ì • ë° ê²°ê³¼ ì €ì¥
        run: |
          git config --global user.name "cowcompany"
          git config --global user.email "cowcompany1@gmail.com"
          git init
          
          # ğŸ”¹ ë°ì´í„° í´ë”ê°€ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ push ì‹¤í–‰
          if [ -n "$(ls -A data/*.csv 2>/dev/null)" ]; then
            git add data/*.csv
            git commit -m "ìë™ í¬ë¡¤ë§ ë°ì´í„° ì €ì¥: $(date)"
            git branch -M main
            git remote add origin https://x-access-token:${{ secrets.GH_PAT }}@github.com/cowcompany/naver-crawling-bot.git
            git push -u origin main
          else
            echo "âŒ CSV íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì•„ pushí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
          fi
